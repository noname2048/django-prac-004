{% extends "index.html" %}
{% load humanize %}

{% block content %}
    <div class="flex flex-col items-center justify-center bg-gray-100 h-screen">
        <div class="flex flex-1 flex-col" style="width: 70%;">
        
            <!--카테고리 정보-->
            <div class="flex bg-white p-3 my-2">
                <div class="flex flex-col flex-1">
                    <div class="flex flex-row items-end">
                        <span class="text-lg">전체글</span>
                        <span class="text-sm">{{ total_count }}</span>
                    </div>
                    <div class="flex items-start">
                        <span class="text-sm">since</span>
                        <span class="text-sm">since</span>
                    </div>
                    <ul class="flex items-start">
                        {% comment %} <li class="px-1"><a class="text-sm border-b">전체글</a></li> {% endcomment %}
                        <li class="px-1"><a class="text-sm border-b">general</a></li>
                        <li class="px-1"><a class="text-sm border-b">free</a></li>
                    </ul>
                </div>
                <div class="flex items-center">
                    <span>img</span>
                </div>
            </div>

            <!--게시글 내용-->
            <div class="flex flex-1 flex-col bg-white px-3">
                <!--제목-->
                <h1 class="flex items-center justify-start">
                    <span class="text-sm px-2 border-r border-indigo-500 text-gray-600">{{ post.author.username }}님</span>
                    <span class="text-xl px-2 py-3">{{ post.title }}</span>
                </h1>

                <!--내용컨테이너-->
                <div class="border">

                    <!--내용헤더-->
                    <div class="border-t-2 border-blue-300 bg-gray-300 flex justify-between items-center">
                        <div class="px-2">
                            <i class="far fa-clock"></i>
                            <span>{{ post.created_at | naturaltime }}</span>
                        </div>
                        <div class="flex items-center justify-center">
                            <span class="px-1"><i class="far fa-comment"></i>{{ post.forumcomment_set.count }}</span>
                            <span class="px-1"><i class="far fa-thumbs-up"></i>{{ post.forumlike_set.count }}</span>
                            <span class="px-1"><i class="far fa-eye"></i>{{ post.forumposthitcount_set.count }}</span>
                        </div>
                    </div>

                    <!--내용-->
                    <div class="flex flex-col p-3">
                        <p class="text-sm" style="min-height: 10rem;">{{ post.content }}</p>
                        <!--좋아요버튼-->
                        <div class="flex justify-center">
                            <form class="border-2 border-green-500 rounded-md px-2 py-1 hover:bg-green-500 text-green-500 text-sm" action="{% url "forum:posts_detail" post.id %}">
                                <button><span><i class="far fa-thumbs-up"></i></span>좋아요 {{ post.forumlike_set.count }}</button>
                                <input type="button" value="like" id="posts_like">
                                {% comment %} <script>
                                    var btn = document.getElementById("posts_like");
                                    btn.addEventListenr("click", () => {
                                        var xhr = new XMLHttpRequest();
                                        xhr.open("GET", "{% url %}", true);
                                        xhr.send();
                                        xhr.onload = () => {
                                            if (xhr.status == 204) {
                                                console.log(xhr.response)
                                            }
                                        }
                                    })
                                </script> {% endcomment %}
                            </form>
                        </div>
                    </div>

                    <!--내용footer-->
                    <div class="p-3 bg-gray-100">
                        <a class="border rounded-md py-1 px-2 bg-white hover:bg-indigo-200 text-xs" href="#">목록</a>
                        <a class="border border-red-400 rounded-md py-1 px-2 bg-transparent hover:bg-red-400 hover:text-white text-xs" href="#">신고</a>
                    </div>

                    <div class="py-2 px-3">
                        <span>댓글</span>
                    </div>

                    <!--comment-->
                    <div>
                        {% for comment in comments %}
                            <div class="m-4 border">
                                <div class="bg-gray-100 py-2">
                                    <span class="text-xs px-1 border-r-2">작성자</span>
                                    {{ comment.author }}
                                </div>
                                <div class="p-2">
                                    {{ comment.content }}
                                </div>
                            </div> 
                        {% endfor %}

                        <!--new comment-->
                        <div class="m-4 border">
                            {% if user.is_authenticated %}
                                <form class="flex flex-col p-4" action="{% url "forum:comments_new" post.id %}" method="POST">
                                    {% csrf_token %}
                                    {{ new_comment_form.as_table }}
                                    <div class="flex justify-start">
                                        <button class="p-2 border rounded-md" type="submit">작성</button>
                                    </div>
                                    
                                </form>
                            {% else %}
                                <p>로그인해 주세요</p>
                                <a href="#">로그인</a>
                            {% endif %}
                            
                        </div>

                    </div>
                </div>
                
                
            </div>

        </div>
    </div>
{% endblock content %}
